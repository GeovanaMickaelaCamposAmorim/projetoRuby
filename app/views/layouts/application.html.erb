<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Tags" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    
    
    <style>
      .scrollbar-hide::-webkit-scrollbar { display: none; }
      .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
      .submenu { transition: all 0.3s ease-in-out; }
      .submenu-arrow { transition: transform 0.2s ease-in-out; }
    </style>
  </head>

  <body class="h-screen"> 
    <% if authenticated? %>
      <div class="flex h-screen overflow-hidden"> 
        <%= render "layouts/sidebar" %>
        <main class="flex-1 flex flex-col min-h-0 overflow-auto bg-tags-cinza-fundo p-6"> 
          <%= yield %>
        </main>
      </div>
    <% else %>
      <%= yield %>
    <% end %>

    <!-- Script do Submenu  -->
    <script>
      // Função para inicializar os submenus
      function initializeSubmenus() {
        console.log('Inicializando submenus...');
        
        document.querySelectorAll('[data-submenu]').forEach(trigger => {
          // Remove event listeners antigos para evitar duplicação
          trigger.replaceWith(trigger.cloneNode(true));
        });

        // Reatacha os event listeners
        document.querySelectorAll('[data-submenu]').forEach(trigger => {
          trigger.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const submenuId = this.getAttribute('data-submenu');
            const submenu = document.getElementById(submenuId);
            const arrow = this.querySelector('.submenu-arrow');
            
            console.log('Clicou no submenu:', submenuId);
            
            // Toggle submenu
            if (submenu.classList.contains('hidden')) {
              submenu.classList.remove('hidden');
              if (arrow) arrow.classList.add('rotate-180');
            } else {
              submenu.classList.add('hidden');
              if (arrow) arrow.classList.remove('rotate-180');
            }
            
            // Close other submenus
            document.querySelectorAll('.submenu').forEach(otherSubmenu => {
              if (otherSubmenu.id !== submenuId && !otherSubmenu.classList.contains('hidden')) {
                otherSubmenu.classList.add('hidden');
                const otherArrow = otherSubmenu.previousElementSibling?.querySelector('.submenu-arrow');
                if (otherArrow) otherArrow.classList.remove('rotate-180');
              }
            });
          });
        });
        
        // Close submenus when clicking outside
        document.addEventListener('click', function(e) {
          if (!e.target.closest('[data-submenu]') && !e.target.closest('.submenu')) {
            document.querySelectorAll('.submenu').forEach(submenu => {
              submenu.classList.add('hidden');
            });
            document.querySelectorAll('.submenu-arrow').forEach(arrow => {
              arrow.classList.remove('rotate-180');
            });
          }
        });
      }

      // Inicializa quando a página carrega
      document.addEventListener('DOMContentLoaded', initializeSubmenus);
      
      // Inicializa quando o Turbo navega
      document.addEventListener('turbo:load', initializeSubmenus);
      document.addEventListener('turbo:render', initializeSubmenus);
      document.addEventListener('turbo:frame-render', initializeSubmenus);
    </script>
  </body>
</html>