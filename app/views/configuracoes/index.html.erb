<% content_for :page_title, "Perfil da Loja" %>
<% content_for :page_description, "Atualize o perfil da loja" %>
<% content_for :page_icon do %>
  <span class="material-symbols-outlined text-xs">store</span>
<% end %>

<div class="mx-auto mt-6">
  <%= form_with model: @contratante, url: configuracoes_path, method: :patch, class: "space-y-8" do |form| %>
    
    <!-- Seção: Perfil da Loja -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      
      <div class="space-y-6">
        <!-- Logo e Informações Básicas - Lado a lado -->
        <div class="flex flex-col md:flex-row gap-8 items-start">
          <!-- Logo/Icone da Loja -->
          <div class="flex-shrink-0">
            <label class="block text-sm font-medium text-gray-700 mb-3 text-center md:text-left">Logo da Loja</label>
            <div class="flex flex-col items-center space-y-3">
              <div class="w-20 h-20 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center logo-preview cursor-pointer hover:border-gray-400 transition-colors">
                <% if @contratante.persisted? && @contratante.logo.attached? %>
                  <%= image_tag @contratante.logo, class: "w-16 h-16 object-contain" %>
                <% else %>
                  <span class="material-symbols-outlined text-gray-400 text-2xl">store</span>
                <% end %>
              </div>
              
              <div class="text-center">
                <%= form.file_field :logo, class: "hidden", id: "logo-upload" %>
                <button type="button" onclick="document.getElementById('logo-upload').click()" 
                        class="px-4 py-2 bg-tags-rosa text-white text-sm rounded-lg hover:bg-pink-600 transition-colors">
                  Alterar Logo
                </button>
                <p class="text-xs text-gray-500 mt-1">PNG, JPG até 5MB</p>
              </div>  
            </div>
          </div> <!-- Fechando a div da logo -->
          
          <!-- Informações da Loja -->
          <div class="flex-1 space-y-4">
            <!-- Nome da Loja -->
            <div>
              <%= form.label :cnt_nome_loja, "Nome da Loja", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.text_field :cnt_nome_loja, 
                    class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tags-rosa focus:border-transparent",
                    placeholder: "Nome da sua loja",
                    required: true %>
            </div>

            <!-- CNPJ e Telefone -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <%= form.label :cnt_cnpj, "CNPJ", class: "block text-sm font-medium text-gray-700 mb-2" %>
                <%= form.text_field :cnt_cnpj, 
                      class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tags-rosa focus:border-transparent",
                      placeholder: "00000000000000",
                      required: true %>
              </div>
              <div>
                <%= form.label :cnt_telefone, "Telefone", class: "block text-sm font-medium text-gray-700 mb-2" %>
                <%= form.text_field :cnt_telefone, 
                      class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tags-rosa focus:border-transparent",
                      placeholder: "(00) 00000-0000",
                      required: true %>
              </div>
            </div>
          </div>
        </div>

        <!-- Endereço -->
        <div class="border-t border-gray-200 pt-6">
          <h3 class="text-md font-medium text-gray-900 mb-4">Endereço</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="md:col-span-1">
              <%= form.label :cnt_cep, "CEP", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.text_field :cnt_cep, 
                    class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tags-rosa focus:border-transparent",
                    placeholder: "00000-000",
                    required: true %>
            </div>
            <div class="md:col-span-2">
              <%= form.label :cnt_endereco, "Endereço Completo", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.text_field :cnt_endereco, 
                    class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tags-rosa focus:border-transparent",
                    placeholder: "Rua, número, bairro, cidade - Estado",
                    required: true %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Seção: Dados do Responsável -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-6">Dados do Responsável</h2>
      
      <div class="space-y-6">
        <!-- Nome e Email do Responsável -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <%= form.label :cnt_nome_responsavel, "Nome Completo", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_field :cnt_nome_responsavel, 
                  class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tags-rosa focus:border-transparent",
                  required: true %>
          </div>
          <!-- Telefone do Responsável -->
          <div>
            <%= form.label :cnt_telefone_responsavel, "Telefone", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_field :cnt_telefone_responsavel, 
                  class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tags-rosa focus:border-transparent",
                  required: true %>
          </div>
        </div>


        <div>
            <%= form.label :cnt_email_responsavel, "E-mail", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.email_field :cnt_email_responsavel, 
                  class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tags-rosa focus:border-transparent",
                  required: true %>
          </div>
      </div>
    </div>
    </div>

    <!-- Botão Salvar -->
    <div class="flex justify-end pt-6">
      <%= form.submit "Salvar Configurações", 
            class: "px-8 py-3 bg-tags-rosa text-white font-medium rounded-lg hover:bg-pink-600 transition-colors cursor-pointer shadow-sm" %>
    </div>
  <% end %>
</div>

<script>
// Preview da logo
document.getElementById('logo-upload')?.addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      const preview = document.querySelector('.logo-preview');
      if (preview) {
        preview.innerHTML = `<img src="${e.target.result}" class="w-16 h-16 object-contain" alt="Preview">`;
      }
    };
    reader.readAsDataURL(file);
  }
});

// Também permite clicar na área da logo para fazer upload
document.querySelector('.logo-preview')?.addEventListener('click', function() {
  document.getElementById('logo-upload').click();
});
</script>