<% content_for :page_title, "Controle de Gastos" %>
<% content_for :page_description, "Gerencie e monitore seus gastos" %>
<% content_for :page_icon do %>
  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
  </svg>
<% end %>

<div class="container mx-auto flex flex-col">

    <!-- Cards resumo -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-6">
      <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
        <p class="text-gray-600 font-medium">Total de Gastos</p>
        <p class="text-3xl font-bold text-red-600"><%= number_to_currency(@gastos.sum(&:gas_valor)) %></p>
      </div>
      <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
        <p class="text-gray-600 font-medium">Gastos Este M√™s</p>
        <p class="text-3xl font-bold text-gray-800"><%= number_to_currency(@total_mes) %></p>
      </div>
      <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
        <p class="text-gray-600 font-medium">M√©dia Mensal</p>
        <%
          # C√°lculo simples da m√©dia mensal (√∫ltimos 6 meses)
          media_mensal = @gastos.where('gas_data >= ?', 6.months.ago).sum(:gas_valor) / 6.0
        %>
        <p class="text-3xl font-bold text-gray-800"><%= number_to_currency(media_mensal) %></p>
      </div>
    </div>

    <!-- Card branco envolvendo busca e grade -->
    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 mb-6">
      <!-- Campo de busca -->
      <%= form_with url: gastos_path, method: :get, local: true, class: "mb-6" do %>
        <%= text_field_tag :search, params[:search], 
              placeholder: "Buscar gasto",
              class: "w-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#ed215e] outline-none" %>
      <% end %>

      <!-- Tabela -->
      <div class="overflow-hidden">
        <table class="w-full text-left">
          <thead class="bg-gray-100 text-gray-700">
            <tr>
              <th class="px-6 py-3 font-medium">Data</th>
              <th class="px-6 py-3 font-medium">Descri√ß√£o</th>
              <th class="px-6 py-3 font-medium">Valor</th>
              <th class="px-6 py-3 font-medium">Usu√°rio</th>
              <th class="px-6 py-3 font-medium">A√ß√µes</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 text-black">
            <% @gastos.each do |gasto| %>
              <tr>
                <td class="px-6 py-3"><%= gasto.gas_data.strftime('%d/%m/%Y') %></td>
                <td class="px-6 py-3"><%= gasto.gas_descricao %></td>
                <td class="px-6 py-3 text-red-600 font-semibold"><%= number_to_currency(gasto.gas_valor) %></td>
                <td class="px-6 py-3"><%= gasto.user.usu_nome %></td>
                <td class="px-6 py-3 flex gap-3">
                  <%= link_to edit_gasto_path(gasto), class: "btn-blue rounded-lg shadow px-3 py-1" do %>
                    ‚úèÔ∏è
                  <% end %>
                  <%= link_to gasto_path(gasto), 
                      method: :delete, 
                      data: { confirm: 'Tem certeza que deseja excluir este gasto?' },
                      class: "text-red-600 hover:text-red-800 transition px-3 py-1" do %>
                    üóëÔ∏è
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>