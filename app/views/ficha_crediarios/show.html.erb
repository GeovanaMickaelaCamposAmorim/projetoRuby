<% content_for :page_title, "Detalhes do Crediário - #{@ficha_crediario.cliente.nome}" %>
<% content_for :page_description, "Histórico de movimentações do crediário" %>

<div class="container mx-auto">
  <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 mb-6">
    <!-- Header da ficha -->
    <div class="flex justify-between items-center mb-6">
      <div>
        <h1 class="text-2xl font-bold text-gray-800">Crediário - <%= @ficha_crediario.cliente.nome %></h1>
      </div>
      <div class="text-right">
        <p class="text-3xl font-bold <%= @ficha_crediario.fic_status == 'pendente' ? 'text-red-600' : 'text-green-600' %>">
          <%= number_to_currency(@ficha_crediario.fic_valor_total) %>
        </p>
        <span class="px-3 py-1 rounded-full text-sm font-medium <%= @ficha_crediario.fic_status == 'pendente' ? 'bg-orange-100 text-orange-800' : 'bg-green-100 text-green-800' %>">
          <%= @ficha_crediario.fic_status.humanize %>
        </span>
      </div>
    </div>

    <!-- Form para nova movimentação -->
    <div class="mb-8 p-4 bg-gray-50 rounded-lg">
      <h2 class="text-lg font-semibold mb-4">Nova Movimentação</h2>
      <%= form_with model: [@ficha_crediario, @movimentacao], local: true do |form| %>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div>
            <%= form.label :mov_data, "Data", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= form.date_field :mov_data, value: Date.current, class: "w-full p-2 rounded-lg border border-gray-300" %>
          </div>
          <div>
            <%= form.label :mov_valor, "Valor", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= form.number_field :mov_valor, step: 0.01, class: "w-full p-2 rounded-lg border border-gray-300" %>
          </div>
          <div class="md:col-span-2">
            <%= form.label :mov_descricao, "Descrição", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= form.text_field :mov_descricao, placeholder: "Descrição da movimentação", class: "w-full p-2 rounded-lg border border-gray-300" %>
          </div>
        </div>
        <div class="mt-4">
          <%= form.submit "Adicionar Movimentação", class: "bg-tags-rosa text-white px-4 py-2 rounded-lg hover:bg-[#d91956] transition-colors" %>
        </div>
      <% end %>
    </div>

    <!-- Histórico de movimentações -->
    <div>
      <h2 class="text-lg font-semibold mb-4">Histórico de Movimentações</h2>
      <% if @movimentacoes.any? %>
        <div class="overflow-hidden">
          <table class="w-full text-left">
            <thead class="bg-gray-100 text-gray-700">
              <tr>
                <th class="px-4 py-2 font-medium">Data</th>
                <th class="px-4 py-2 font-medium">Descrição</th>
                <th class="px-4 py-2 font-medium">Valor</th>
                <th class="px-4 py-2 font-medium">Ações</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
              <% @movimentacoes.each do |mov| %>
                <tr>
                  <td class="px-4 py-2"><%= mov.mov_data.strftime('%d/%m/%Y') %></td>
                  <td class="px-4 py-2"><%= mov.mov_descricao %></td>
                  <td class="px-4 py-2 font-semibold <%= mov.mov_valor.positive? ? 'text-red-600' : 'text-green-600' %>">
                    <%= number_to_currency(mov.mov_valor) %>
                  </td>
                  <td class="px-4 py-2">
                    <%= link_to "Excluir", movimentacao_crediario_path(mov), 
                        method: :delete, 
                        data: { confirm: 'Tem certeza?' },
                        class: 'text-red-600 hover:text-red-900 text-sm' %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="text-gray-500 text-center py-4">Nenhuma movimentação registrada.</p>
      <% end %>
    </div>
  </div>

  <%= link_to "Voltar", ficha_crediarios_path, class: "text-blue-600 hover:text-blue-800" %>
</div>